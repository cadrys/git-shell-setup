#!/bin/sh

# changeid
#	pass changeid
if [ $# -eq 1 ] && [[ "$1" == I* ]] && [ ${#1} == 41 ]; then
	id="$1"
	start chrome --new-window "$GerritUrl$id"
	exit
fi

# commit
#	parse changeid from commit message and pass
if [ $# -eq 1 ] && [[ $(git cat-file -t "$1" 2>/dev/null) == "commit" ]]; then
	commit="$1"
	last=$(git log -1 $commit | tail -1 | sed 's/ *//')
	if [[ "$last" != Change-Id* ]]; then
		# changeid not present
		echo "fatal: no Change-Id found"
		exit 1
	fi
	id=$(echo $last | sed 's/Change-Id: //')
	gq "$id"
	exit
fi

# query
#	pass all args
start chrome --new-window "$GerritUrl$*"
