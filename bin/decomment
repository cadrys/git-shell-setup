#!/bin/sh

#usage:
#   ... | decomment
#
# Strip '//' comments, remove trailing ','.
#
# Note: Use for jq as,
#   ... | decomment | jq .

exec sed -E \
	'
	# do not remove // in json property name or value so
	# remove // after even occurences of ", ie after 4th, 2nd, 0th
	s:^(([^"/]*"[^"]*"){0,2}[^"/]*)//.*:\1:
	# remove empty or whitespace lines
	/^\s*$/ d
	# remove trailing comma
	# see https://stackoverflow.com/questions/53201028/sed-remove-trailing-json-comma/53201424#53201424
	/^\s*}/ {
		H
		x
		s:,\n:\n:
		b
	}
	x
	/^\s*}/ d
	/^$/ d
	'
