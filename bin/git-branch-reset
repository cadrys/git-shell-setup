#!/bin/sh

#usage: git branch-reset master next dev
#
# Force branches to point to their remote branches.

# get current branch
# note: 'git symbolic-ref --short HEAD' throws when in 'detached HEAD' state
currBranch=$(git rev-parse --abbrev-ref HEAD)
# if no arg, breset current branch
if [ -z "$1" ]; then
	set -- "$currBranch"
fi
for ((i=1;i<=$#;i++)); do
	branch=$(git rev-parse --abbrev-ref ${!i})
	remoteBranch=$(git rev-parse --abbrev-ref $branch@{u} 2>/dev/null)
	if [ -z $remoteBranch ]; then
		echo 1>&2 "fatal: no remote branch for branch $branch"
		continue
	fi
	if [ "$branch" = "$currBranch" ]; then
		# if current branch, then reset --hard
		command=$(echo "git reset --hard $remoteBranch")
		echo -e "${White}$command${None}"
		$command
	else
		# else force branch
		command=$(echo "git branch -f $branch $remoteBranch")
		echo -e "${White}$command${None}"
		$command
	fi
done
