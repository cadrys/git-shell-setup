#!/bin/sh

#usage: remote
#
# Browse to remote's url.

if [[ "$1" == "-h" ]]; then print-file-comments "$0"; exit; fi

GerritUrlQuery="$GerritUrl/#/q/"
remoteBranch=$(git remote-branch HEAD 2>/dev/null)
git config --get-regex remote\..*\.url \
	| cut -d' ' -f2 \
	| \
		while read line;
		do
			if egrep -q '@'"$GerritUrl"':' <<< "$line"; then
				# gerrit
				sed -r '
					s,\.git$,,
					s,^ssh://.+@'"$GerritUrl"':[0-9]+/,,
					s,^,'"$GerritUrlQuery"'project:,
					' <<< "$line"
			else
				# others: github, gitlab, etc.
				# add branch specific url part
				if [[ ! -z "$remoteBranch" && "$remoteBranch" != "master" ]]; then
					tree="/tree/$remoteBranch"
				fi
				sed -r '
					s,\.git$,,
					s,^git@,,
					s,^https?://,,
					s,:,/,
					s,$,'"$tree"',
					' <<< "$line"
			fi
		done \
	| browse
